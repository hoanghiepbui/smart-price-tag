{% extends "base.html" %}

{% block title %}Danh sách Display{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="h3">Danh sách Display</h1>
  <a href="/admin/displays/new" class="btn btn-primary">+ Thêm display</a>
</div>

<!-- FORM CHỌN ACTIVE DISPLAY: PHẢI NẰM TRONG block content -->
<form method="post" action="/admin/displays/active" class="bg-white p-3 border rounded mb-3">
  <label class="form-label">Display đang active (ESP32 sẽ hiển thị theo display này)</label>
  <div class="d-flex gap-2">
    <select class="form-select" name="active_code" style="max-width: 360px;">
      {% for d in displays %}
        <option value="{{ d.code }}" {% if d.code == active_code %}selected{% endif %}>
          {{ d.code }} - {{ d.name or '' }}
        </option>
      {% endfor %}
    </select>
    <button class="btn btn-primary" type="submit">Áp dụng</button>
  </div>
  <div class="form-text">
    ESP32 sẽ gọi <code>/display/active</code> thay vì cố định code trong firmware.
  </div>
</form>

<table class="table table-striped table-bordered bg-white">
  <thead class="table-dark">
    <tr>
      <th>ID</th>
      <th>Code</th>
      <th>Tên</th>
      <th>Vị trí</th>
      <th>Sản phẩm</th>
      <th>Trạng thái</th>
      <th>Pin</th>
      <th>Signal</th>
      <th>Last seen</th>
      <th>Hành động</th>
    </tr>
  </thead>
  <tbody>
    {% for d in displays %}
    <tr>
      <td>{{ d.id }}</td>
      <td>{{ d.code }}</td>
      <td>{{ d.name or '' }}</td>
      <td>{{ d.location or '' }}</td>
      <td>{{ d.product.name if d.product else '' }}</td>
      <td>{{ d.status }}</td>
      <td>{{ d.battery_level if d.battery_level is not none else '' }}</td>
      <td>{{ d.signal_strength if d.signal_strength is not none else '' }}</td>
      <td>{{ d.last_seen_at or '' }}</td>
      <td>
        <a class="btn btn-sm btn-outline-secondary" href="/admin/displays/{{ d.id }}/edit">Sửa</a>
      </td>
    </tr>
    {% else %}
    <tr>
      <td colspan="10" class="text-center text-muted">Chưa có display nào</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
